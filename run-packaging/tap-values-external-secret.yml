apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tap-values-external-secret
  namespace: tap-install
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: SecretStore
    name: tap-eso-vault

  target:
    name: tap-values-external-secret
    creationPolicy: Owner
    template:
      data:
        tap-values.yml: |
          profile: run
          ceip_policy_disclosed: true

          shared:
            ingress_domain: run.postcvs.tapsme.org

          supply_chain: basic

          contour:
            envoy:
              service:
                type: LoadBalancer

          appliveview_connector:
            backend:
              ingressEnabled: true
              host: appliveview.postcvs.tapsme.org
              port: "443"
              sslDisabled: false
              caCertData: | 
          {{ .alvconnectorcacert | b64dec }}

          appsso:
            domain_name: "run.postcvs.tapsme.org"

          api_auto_registration:
            logging_profile: development
            tap_gui_url: "https://tap-gui.postcvs.tapsme.org"
            ca_cert_data: |
              -----BEGIN CERTIFICATE-----
              MIIDGzCCAgOgAwIBAgIQaGCcRYJeualoAwhH61BxjDANBgkqhkiG9w0BAQsFADAl
              MSMwIQYDVQQDExp0YXAtZ3VpLnBvc3RjdnMudGFwc21lLm9yZzAeFw0yMjEwMTgx
              NjAxMjlaFw0yMzAxMTYxNjAxMjlaMCUxIzAhBgNVBAMTGnRhcC1ndWkucG9zdGN2
              cy50YXBzbWUub3JnMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2v2q
              mr5u6hM5qZJTyzsWap679YI965hULUGYLFFioH9+BaNgXXkwSzDtO1l5L+07kEye
              MvFFnE4+GeLMJCIBnmHT+X7PjWtoz71nl8HXHI/vJVc7ECL/RHVKZtUdqcJqKmsT
              NsJQbA83NtH+1gOUzfA8zIutiKf002OdViBoQ8j6hDeUMS9NO5ZI2LdjHCHqOBGH
              SrblNHR2ECCRG4F+SGJV7BTIHJ7pQnKHZ0UN+xlxVelHeBATWqP5TTFdh2s9SsPj
              7UXgcxXjPO5Nl1e6Wlb+0BHfScBu/uCCk+KEuS06O+D8UCm+k0MePPK3+/t7/9Qe
              Wp0hTpdGBroW8ebrVwIDAQABo0cwRTAOBgNVHQ8BAf8EBAMCBaAwDAYDVR0TAQH/
              BAIwADAlBgNVHREEHjAcghp0YXAtZ3VpLnBvc3RjdnMudGFwc21lLm9yZzANBgkq
              hkiG9w0BAQsFAAOCAQEADEfQg5yOwzKf3YQCTY3cglZ+3ZqqXoqAkCvigQKGVelt
              zaHRVp0HBDkjQzHuXNqSqkmtIEj94oK40BE4Y1nquwqxW+JA9JnQCL+vw7Q2Vyul
              8BI/yz+O6ES2tBhjdedsn2iSqtr00FFftEmNX4DJoVKwBZ/IXCBwLOkiwEcMKRFn
              Vxx3cKlBX0zcEtVQQhROT2H3mI1i99HqPa1jLAY2fX7/s5gW51pq5NCoDb+RdFYw
              hLFHoBkavE8XNUvgwvei9nIqK3DikeCSDpKSFK29+JHgnl4x6T5rgHMHsxNdyEb9
              9iHXayP11IkAjdtorkebQ5QebIW8tqUdBZTWVuHbfQ==
              -----END CERTIFICATE-----
          
          cnrs:
            domain_name: run.postcvs.tapsme.org
            default_tls_secret: "tap-install/workload-cert-secret"
  data:
  - secretKey: alvconnectorcacert
    remoteRef:
      key: alvconnectorcacert
  - secretKey: tapguitlscacert
    remoteRef:
      key: tapguitlscacert